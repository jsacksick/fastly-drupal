parameters:
  fastly.host: 'https://api.fastly.com/'
  fastly.connect_timeout: 3
  fastly.webhook_connect_timeout: 2
services:
  fastly.api:
    class: Drupal\fastly\Api
    arguments: ['@config.factory', '%fastly.host%', '@http_client', '@logger.channel.fastly', '@fastly.state', '%fastly.connect_timeout%', '@fastly.services.webhook', '@request_stack', '@fastly.cache_tags.hash', '@messenger']
  fastly.cache_tags.hash:
    class: Drupal\fastly\CacheTagsHash
    arguments: ['@config.factory', '@logger.channel.fastly']
  fastly.cache_tags.invalidator:
    class: Drupal\fastly\CacheTagsInvalidator
    arguments: ['@fastly.api', '@fastly.cache_tags.hash']
    tags:
      - { name: cache_tags_invalidator }
  fastly.cache_tags.surrogate_key_generator:
    class: Drupal\fastly\EventSubscriber\SurrogateKeyGenerator
    arguments: ['@logger.channel.fastly','@fastly.cache_tags.hash']
    tags:
      - { name: event_subscriber }
  fastly.cache_tags.add_stale_headers:
    class: Drupal\fastly\EventSubscriber\AddStaleHeaders
    arguments: ['@logger.channel.fastly', '@config.factory']
    tags:
      - { name: event_subscriber }
  fastly.state:
    class: Drupal\fastly\State
    arguments: ['@state']
    tags:
      - { name: fastly}
  logger.channel.fastly:
    parent: logger.channel_base
    arguments: ['fastly']
  fastly.vclhandler:
    class: Drupal\fastly\VclHandler
    arguments: ['@config.factory', '%fastly.host%', '@fastly.api', '@logger.channel.fastly', '@fastly.services.webhook', '@request_stack', '@messenger','@module_handler', '@extension.path.resolver']
  fastly.services.webhook:
    class: Drupal\fastly\Services\Webhook
    arguments: ['@config.factory', '@http_client', '@logger.channel.fastly', '%fastly.webhook_connect_timeout%','@request_stack']
